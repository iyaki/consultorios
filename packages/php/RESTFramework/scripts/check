#!/usr/bin/env bash

if [ -z "$CI" ]
then
  set -e
  set -o pipefail
fi

CODE_DIRECOTRY='src/'

SCRIPT_DIR="$(dirname $(realpath "$0"))"

source "$SCRIPT_DIR/../../../bash/ci_utils.sh"

cd "$SCRIPT_DIR/../"

ci-setup "$SCRIPT_DIR"

check-conflicts

commented-code "$CODE_DIRECOTRY"

file-class-name "$CODE_DIRECOTRY"

multi-classes "$CODE_DIRECOTRY"

coding-standars

unused-packages \
  --excludePackage=league/openapi-psr7-validator \
  --excludePackage=mezzio/mezzio-cors \
  --excludePackage=mezzio/mezzio-fastroute \
  --excludePackage=mezzio/mezzio-helpers \
  --excludePackage=mezzio/mezzio

find-transitive-depndencies "$SCRIPT_DIR/../require-checker.json"

find-magic-numbers \
  --exclude-path="Clockwork/" \
  -- "$CODE_DIRECOTRY"

find-copy-pasted-code "$CODE_DIRECOTRY"

static-analysis

remake-autoloader

exit $EXIT_STATUS
